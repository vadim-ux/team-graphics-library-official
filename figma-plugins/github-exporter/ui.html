<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    padding: 16px;
    margin: 0;
    color: #333;
  }
  .form-group {
    margin-bottom: 12px;
  }
  label {
    display: block;
    font-size: 12px;
    font-weight: 500;
    margin-bottom: 4px;
  }
  input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
  input[type="password"] {
    font-family: monospace;
  }
  button {
    background-color: #0d99ff;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 10px 16px;
    width: 100%;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    margin-top: 8px;
  }
  button:hover {
    background-color: #007be5;
  }
  button#saveBtn {
    background-color: #555;
  }
  button#saveBtn:hover {
    background-color: #333;
  }
  #status {
    margin-top: 16px;
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 8px;
    font-family: monospace;
    font-size: 11px;
    height: 150px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  #status p {
    margin: 0 0 4px;
    padding: 0;
  }
  .success { color: #28a745; }
  .error { color: #dc3545; }
</style>

<div class="form-group">
  <label for="token">GitHub Personal Access Token</label>
  <input type="password" id="token" placeholder="ghp_...">
</div>

<div class="form-group">
  <label for="repo">Repository (owner/repo_name)</label>
  <input type="text" id="repo" placeholder="vadim-ux/team-graphics-library">
</div>

<div class="form-group">
  <label for="branch">Branch</label>
  <input type="text" id="branch" value="main">
</div>

<button id="saveBtn">Save Settings</button>
<button id="exportBtn">Export to GitHub</button>

<div id="status">Waiting for command...</div>

<script>
  const tokenInput = document.getElementById('token');
  const repoInput = document.getElementById('repo');
  const branchInput = document.getElementById('branch');
  const statusEl = document.getElementById('status');

  // On UI load, request saved settings
  window.onload = () => {
    parent.postMessage({ pluginMessage: { type: 'load-settings' } }, '*');
  };

  document.getElementById('saveBtn').onclick = () => {
    parent.postMessage({
      pluginMessage: {
        type: 'save-settings',
        settings: {
          token: tokenInput.value,
          repo: repoInput.value,
          branch: branchInput.value
        }
      }
    }, '*');
  };

  document.getElementById('exportBtn').onclick = () => {
    statusEl.innerHTML = 'Starting export...<br>';
    parent.postMessage({ pluginMessage: { type: 'export-to-github' } }, '*');
  };

  onmessage = (event) => {
    const msg = event.data.pluginMessage;
    
    if (msg.type === 'settings-loaded') {
      if (msg.settings) {
        tokenInput.value = msg.settings.token || '';
        repoInput.value = msg.settings.repo || '';
        branchInput.value = msg.settings.branch || 'main';
      }
    } else if (msg.type === 'status-update') {
      const p = document.createElement('p');
      p.className = msg.isError ? 'error' : 'success';
      p.textContent = msg.text;
      statusEl.appendChild(p);
      statusEl.scrollTop = statusEl.scrollHeight; // auto-scroll to bottom
    }
  };
</script>